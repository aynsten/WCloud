name: publish-nuget

on:
  workflow_dispatch:

jobs:
  build:

    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v2
      - name: Setup .NET Core
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 3.1.301
      
      - name: add-nuget-source
        run: dotnet nuget add source https://nuget.pkg.github.com/wcloud-net/index.json 
          --name GitHub 
          --username hiwjcn 
          --password ${{secrets.GITHUB_TOKEN}}
        shell: pwsh
        
      - name: pack-and-push-lib
        working-directory: ./src/Lib/
        run: |
          dotnet pack -c Release
          dotnet nuget push ./bin/Release/*.nupkg --source GitHub --skip-duplicate
        shell: pwsh
